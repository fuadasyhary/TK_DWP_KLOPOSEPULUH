<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Profil TK Dharma Wanita Persatuan Kloposepuluh</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#FFFDF2; /* soft cream */
      --card:#FFFFFF;
      --accent:#FF7AA2; /* playful pink */
      --accent-2:#FFD166; /* yellow */
      --muted:#6B7280;
      --kid-1:#7AD6FF;
      --kid-2:#B3FF9E;
      --radius:18px;
      --glass: rgba(255,255,255,0.7);
    }
    *{box-sizing:border-box}
    body{
        font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; 
        margin:0; 
        background:linear-gradient(180deg,var(--bg),#ff2e2e); 
        color:#111;
        
        /* Background tematik sekolah */
        background-color: #FFFDF2;
        background-image: url("bg.png");
        opacity: 0.9;  /* ‚úÖ gambar background transparan 30% */
        z-index: -1;   /* biar selalu di belakang konten */
    }
    header{padding:28px 20px 12px; display:flex; gap:16px; align-items:center}
    .logo{width:88px;height:88px;border-radius:22px;background:linear-gradient(135deg,var(--kid-1),var(--kid-2));display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(0,0,0,0.08);}
    .logo svg{width:64px;height:64px}
    h1{font-family:'Baloo 2',cursive;margin:0;font-size:20px}
    .sub{font-size:12px;color:#ffffff;margin-top:4px}

    main{padding:20px;max-width:980px;margin:0 auto}
    .hero{display:flex;gap:20px;align-items:center;background:linear-gradient(90deg,#fff, #fff0);padding:18px;border-radius:18px;border:1px solid rgba(10,10,10,0.03)}
    .hero-left{flex:1}
    .hero-right{width:160px}
    .card{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 8px 20px rgba(13,12,20,0.04);}

    .profile-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:14px}
    .field{padding:12px;border-radius:12px;background:linear-gradient(180deg,var(--glass),#fff);border:1px dashed rgba(0,0,0,0.04)}
    .k{font-size:11px;color:var(--muted);margin-bottom:6px}
    .v{font-weight:400}

    .badge{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;font-weight:700}

    .actions{display:grid;gap:10px;margin-top:12px;justify-content: space-around;}
    .btn{padding:10px 14px;border-radius:12px;border:0;cursor:pointer;font-weight:600}
    .btn-primary{background:var(--accent);color:white}
    .btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.06)}

    .mascot{display:flex;flex-direction:column;align-items:center;justify-content:center;height:140px}
    .mascot svg{width:120px;height:120px}

    footer{max-width:980px;margin:22px auto;padding:12px;text-align:center;color:#bbc1cd;}

    .map-container {
      margin: 20px 0;
      padding: 16px;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 6px 16px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .map-container iframe {
      width: 100%;
      max-width: 500px;
      height: 300px;
      border: 0;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    /* responsive tweak */
    @media(min-width:800px){
      .hero{padding:28px}
      h1{font-size:26px}
    }
    
    #galleryContainer {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      padding: 10px;
    }

    .gallery-item {
      background: #fff;
      border-radius: 8px;
      padding: 6px;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .gallery-item b {
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
    }

    .gallery-img, .gallery-video {
      width: 100%;
      height: auto;
      border-radius: 6px;
      cursor: pointer;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
    }
    .gallery-grid img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 3px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      transition: transform 0.2s ease;
      cursor: pointer;
    }
    .gallery-grid img:hover {
      transform: scale(1.05);
    }

    .guru-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      text-align: center;
    }
    .guru-card {
      position: relative;
      overflow: hidden;
    }

    .guru-card:hover .guru-img {
      transform: scale(1.05) rotate(-2deg);
      transition: transform 0.4s ease-in-out;
    }

    /* Confetti/bintang */
    .guru-card::after {
      content: "‚ú®‚ú®‚ú®";
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translateX(-50%) scale(0);
      font-size: 20px;
      opacity: 0;
      transition: all 0.5s ease-in-out;
    }

    .guru-card:hover::after {
      transform: translateX(-50%) scale(1.5);
      opacity: 1;
    }
    .guru-img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 50%;
      margin-bottom: 12px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    .guru-card h3 {
      margin: 8px 0 4px 0;
      font-size: 18px;
      font-weight: bold;
      color: #333;
    }
    .guru-card p {
      margin: 0;
      font-size: 14px;
      color: #666;
    }

    .kids-animation {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: 180px;
      height: 180px;
      z-index: 999;
      pointer-events: none;
    }

    /* üî• Efek buku untuk setiap section */
    .book-section {
      position: relative;
      background: #fff;
      padding: 24px;
      margin: 30px 0;
      border-radius: 8px;
      box-shadow: inset 0 0 40px rgba(0,0,0,0.05),
                  0 8px 18px rgba(0,0,0,0.08);
      font-family: 'Georgia', serif;
      line-height: 1.6;
    }

    /* Efek garis lipatan tengah */
    .book-section::before {
      content: "";
      position: absolute;
      top: 0;
      bottom: 0;
      left: 50%;
      width: 2px;
      background: linear-gradient(to bottom, rgba(0,0,0,0.15), rgba(0,0,0,0));
      transform: translateX(-50%);
    }

    /* Tambah efek pinggiran halaman */
    .book-section::after {
      content: "";
      position: absolute;
      top: 10px;
      bottom: 10px;
      left: 5px;
      right: 5px;
      border: 1px solid rgba(0,0,0,0.06);
      pointer-events: none;
      border-radius: 6px;
    }
    .video-content {
      display: none;
    }
    .video-content:first-child {
      display: grid; /* default tab pertama tampil */
    }
    .video-tab-btn {
      padding:8px 14px;
      border-radius:12px;
      border:1px solid #ddd;
      background:#f5f5f5;
      cursor:pointer;
      font-weight:600;
      transition:0.2s;
    }
    .video-tab-btn.active {
      background:var(--accent);
      color:white;
      border-color:var(--accent);
    }
    
    .tab-btn {
      padding:8px 14px;
      border-radius:12px;
      border:1px solid #ddd;
      background:#f5f5f5;
      cursor:pointer;
      font-weight:600;
      transition:0.2s;
    }
    .tab-btn.active {
      background:var(--accent);
      color:white;
      border-color:var(--accent);
    }

    /* FORM TESTIMONI */
    .testi-card {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 6px 16px rgba(0,0,0,0.08);
    }

    #testiForm {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    #testiForm input,
    #testiForm textarea,
    #testiForm select {
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #ddd;
      font-size: 14px;
      outline: none;
      transition: border 0.2s;
      font-family: Inter, sans-serif;
    }

    #testiForm input:focus,
    #testiForm textarea:focus,
    #testiForm select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(255,122,162,0.2);
    }

    #testiForm button {
      background: var(--accent);
      color: white;
      font-weight: 600;
      padding: 12px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      transition: 0.2s;
    }

    #testiForm button:hover {
      background: #ff5a8d;
    }

    /* LIST TESTIMONI */
    #testimoniList {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    max-height: 400px;   /* tinggi maksimal container */
    overflow-y: auto;    /* muncul scroll kalau lebih dari 5 */
    padding-right: 6px;  /* biar ada jarak dari scrollbar */
  }

  #testimoniList::-webkit-scrollbar {
    width: 6px;
  }
  #testimoniList::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 6px;
  }

    .testimoni-item {
      background: var(--glass);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      animation: fadeIn 0.3s ease;
    }

    .testimoni-item p {
      margin: 0;
      font-size: 15px;
      color: #444;
    }

    .testimoni-item .stars {
      margin: 6px 0;
      color: #FFD166;
      font-size: 18px;
    }

    .testimoni-item h4 {
      margin: 0;
      font-size: 14px;
      font-weight: 600;
      color: var(--accent);
      text-align: right;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px);}
      to { opacity: 1; transform: translateY(0);}
    }

    .overall-rating {
      display: flex;
      align-items: center;
      gap: 10px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      padding: 8px 14px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      color: #fff;
      font-weight: 700;
    }

    .overall-rating .stars {
      font-size: 20px;
      letter-spacing: 2px;
      text-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }

    .overall-rating .title {
      font-size: 16px;
    }

    .overall-rating .score {
      font-size: 14px;
      opacity: 0.9;
    }

    #captchaOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      pointer-events: all; /* blok klik web di bawah */
    }
    .captcha-container {
      background: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      max-width: 80%;
      position: relative;
    }
    .captcha-container h2 {
      color: #ff4081;
      margin-bottom: 10px;
      font-size: 24px;
    }
    .captcha-container p {
      color: #333;
      margin-bottom: 20px;
    }
    .captcha-area {
    width: 90%;
    max-width: 300px;
    min-height: 200px;
    background: #f9f9f9;
    border-radius: 12px;
    margin: 0 auto;
    padding: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    overflow: hidden;
    position: relative; /* penting biar absolute child tetap di dalam */
  }
  #dropZone {
    width: 70px;
    height: 70px;
    border: 2px dashed #555;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fff;
  }
  .captcha-icons {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
  }
  .captcha-icon {
    font-size: 28px;
    cursor: grab;
    user-select: none;
    touch-action: none;
  }

    /* teks biar tidak overflow */
    .captcha-status {
      font-size: 14px;
      text-align: center;
      word-wrap: break-word;
      line-height: 1.4;
    }

    /* hp kecil */
    @media (max-width: 480px) {
      #dropZone {
        width: 55px;
        height: 55px;
      }
      .captcha-icon {
        font-size: 22px;
      }
      .captcha-status {
        font-size: 12px;
      }
    }

    /* playful confetti */
    .confetti{position:absolute;pointer-events:none;z-index:0;opacity:0.9}
  </style>
</head>
<body>
  <header>
    <div aria-hidden>
      <img src="logo.png" alt="Logo Sekolah" style="width:64px;height:64px;">
      </svg>
    </div>
    <div>
      <h1>TK DHARMA WANITA PERSATUAN KLOPOSEPULUH</h1>
      <div class="sub">NPSN: <strong>20563203</strong> <br> PAUD ‚Äî SWASTA</div>
    </div>
    <div style="margin-left:auto;display:flex;flex-direction:column;align-items:flex-end">
      <a href="https://ban-pdm.id/satuanpendidikan/20563203"><div class="badge">AKREDITASI: C</div></a>
      <div class="sub" style="margin-top:8px">Naungan: Yayasan Dharma Wanita Persatuan Sidoarjo</div>
    </div>
  </header>

  <!-- üîí CAPTCHA Overlay -->
  <div id="captchaOverlay" style="
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.8);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:99999;">

  <div class="captcha-container" style="
    background:white;
    padding:20px;
    border-radius:16px;
    text-align:center;
    max-width:320px;
    width:90%;">
    
    <h2>üîí Verifikasi Dulu</h2>
    <p>Geser icon yang benar ke kotak üéØ</p>
    
    <div class="captcha-area" id="captchaArea">
      <div id="dropZone">üéØ</div>
      <div class="captcha-icons" id="iconContainer"></div>
      <div class="captcha-status" id="captchaStatus"></div>
      <button id="captchaReset" class="btn btn-primary" style="display:none;">Coba Lagi</button>
    </div>
    
  </div>
  </div>

    <!-- üî• Animasi Anak-anak -->
  <div class="kids-animation">
    <script src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.6.2/dist/dotlottie-wc.js" type="module"></script>
  <dotlottie-wc src="https://lottie.host/128d49d9-7965-416b-a0cf-dc3b87dc438e/W9LRfpvXx9.lottie" style="width: 180px;height: 180px" speed="1" autoplay loop></dotlottie-wc>
  </div>
  
  <main>
    <section class="hero card" aria-labelledby="about-title">
      <div class="hero-left">
        <h2 id="about-title" style="margin:0;font-size:18px">Selamat datang di profil kami üëã</h2>
        <p style="margin:20px 0 0;color:var(--muted)">Visi dan Misi</p>

        <p style="margin:20px 0 0;color:var(--muted)">Visi</p>
        <p style="margin:3px 0 0;color:var(--muted)">‚ÄúMembentuk Generasi Yang Mandiri, Cerdas, Berprestasi Dan Berakhlak Mulia‚Äù</p>
          
        <p style="margin:10px 0 0;color:var(--muted)">Misi</p>
          
        <p style="margin:3px 0 0;color:var(--muted)">1. Membangun Pembiasaan Berperilaku Hidup Sehat, Bersih Dan Berakhlak Mulia</p>
          
          
        <p style="margin:3px 0 0;color:var(--muted)">2. Membangun Kecerdasan Anak Dalam Aspek Kognitif, Afektif, Spiritual Maupun Sosial</p>
          
          
        <p style="margin:3px 0 0;color:var(--muted)">3. Mengembangkan Kreativitas Yang Inovatif Pada Anak, Sehingga Mampu Bersosialisasi</p>
          
          
          
        <p style="margin:10px 0 0;color:var(--muted)">Tujuan</p>
          
        <p style="margin:3px 0 0;color:var(--muted)">1. Melatih Untuk Beriman Dan Bertaqwa Kepada Tuhan Yang Maha Esa</p>
          
          
        <p style="margin:3px 0 0;color:var(--muted)">2. Melatih Untuk Mandiri Dalam Kegiatan Sehari-hari</p>
          
          
        <p style="margin:3px 0 0;color:var(--muted)">3. Melatih Untuk Hidup Bersama Dan Berguna Bagi Orang Lain</p>

        <div style="margin-top:14px;display:flex;gap:8px;flex-wrap:wrap">
          <div class="card" style="padding:10px;border-radius:12px">No. SK Pendirian<br><a href="https://dapo.kemendikdasmen.go.id/sekolah/01A883E38029620E2DF6"><strong>077/104.10/i-90</strong></a></div>
          <div class="card" style="padding:10px;border-radius:12px">Tgl SK Pendirian<br><strong>17 Jan 1990</strong></div>
          <div class="card" style="padding:10px;border-radius:12px">SK Operasional<br><a href="https://dapo.kemendikdasmen.go.id/sekolah/01A883E38029620E2DF6"><strong>421.1/1810/438.5.1/2019</strong></a></div>
        </div>

        <div class="actions">
          <button class="btn btn-primary" onclick="window.location.href='https://forms.zohopublic.com/tkdwpklopox/form/PendaftaranSiswaTK/formperma/6LN1Dx6Z1YKB5_Q94LM3DKG4fCyGJJly-_FvFA-414s'">Pendaftaran / Pindahan</button>
          <button class="btn btn-ghost" onclick="openReportPopup()">Report Pendaftaran</button>
          <button class="btn btn-ghost" onclick="window.location.href='elearning/index.html'">E-Learning</button>
        </div>
      </div>
    </section>

    <section id="profil" class="card" style="margin-top:14px">
      <h3 style="margin:0 0 8px 0">üè´ Profil Sekolah</h3>
      <div class="profile-grid">

        <div class="field">
          <div class="k">Nama</div>
          <div class="v">TK Dharma Wanita Persatuan Kloposepuluh</div>
        </div>

        <div class="field">
          <div class="k">Kementerian Pembina</div>
          <div class="v">Kementerian Pendidikan Dasar dan Menengah</div>
        </div>

        <div class="field">
          <div class="k">Naungan</div>
          <div class="v">Yayasan Dharma Wanita Persatuan Sidoarjo</div>
        </div>

        <div class="field">
          <div class="k">NPYP</div>
          <div class="v">AX2059</div>
        </div>

        <div class="field">
          <div class="k">No. SK. Pendirian</div>
          <div class="v">077/104.10/i-90</div>
        </div>

        <div class="field">
          <div class="k">Tanggal SK. Pendirian</div>
          <div class="v">17-01-1990</div>
        </div>

        <div class="field">
          <div class="k">Nomor SK Operasional</div>
          <div class="v">421.1/1810/438.5.1/2019</div>
        </div>

        <div class="field">
          <div class="k">Tanggal SK Operasional</div>
          <div class="v">21-05-2019</div>
        </div>

        <div class="field">
          <div class="k">Tanggal Upload SK Op.</div>
          <div class="v">14-01-2020 07:15:08</div>
        </div>

        <div class="field">
          <div class="k">NPSN</div>
          <div class="v">20563203</div>
        </div>

        <div class="field">
          <div class="k">Desa / Kelurahan</div>
          <div class="v">Kloposepuluh</div>
        </div>

        <div class="field">
          <div class="k">Kecamatan</div>
          <div class="v">Sukodono</div>
        </div>

        <div class="field">
          <div class="k">Kabupaten</div>
          <div class="v">Sidoarjo</div>
        </div>

        <div class="field">
          <div class="k">Provinsi</div>
          <div class="v">Jawa Timur</div>
        </div>

        <div class="field">
          <div class="k">Status Sekolah</div>
          <div class="v">Swasta</div>
        </div>

        <div class="field">
          <div class="k">Bentuk Pendidikan</div>
          <div class="v">TK</div>
        </div>

        <div class="field">
          <div class="k">Jenjang Pendidikan</div>
          <div class="v">PAUD</div>
        </div>

        <div class="field">
          <div class="k">Akreditasi</div>
          <div class="v">C</div>
        </div>

      </div>
    </section>
    
    <!-- üî• Profil Guru -->
    <section class="card" style="margin-top:14px">
      <h2 style="margin:0 0 16px 0; text-align:center;">üë©‚Äçüè´ Profil Guru</h2>
      <div id="guruContainer" class="guru-grid"></div>
    </section>
      
    <!-- üî• Section Galeri dengan Tab -->
    <section class="card" style="margin-top:14px">
      <h2 style="margin:0 0 16px 0; text-align:center;">üì∏üé¨ Galeri Sekolah</h2>
      
      <div id="categoryButtons" class="gallery-tabs" style="display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-bottom:16px;"></div>
      <div id="galleryContainer" class="gallery-grid gallery-content"></div>
    </section>

    <!-- Modal Full Galeri -->
    <div id="gallery-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);align-items:center;justify-content:center;z-index:9999;">
      <span id="close-gallery" style="position:absolute;top:20px;right:30px;font-size:30px;color:#fff;cursor:pointer;">&times;</span>
      <img id="gallery-full-img" src="" alt="Full Gallery" style="max-width:90%;max-height:90%;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.6);transition:0.3s">
      <button id="prev-img" style="position:absolute;left:20px;top:50%;transform:translateY(-50%);font-size:40px;color:#fff;background:none;border:none;cursor:pointer;">&#10094;</button>
      <button id="next-img" style="position:absolute;right:20px;top:50%;transform:translateY(-50%);font-size:40px;color:#fff;background:none;border:none;cursor:pointer;">&#10095;</button>
    </div>

    <!-- üî• Modal Full Video -->
    <div id="video-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.9);align-items:center;justify-content:center;z-index:99999;">
      <span id="close-video" style="position:absolute;top:20px;right:30px;font-size:30px;color:#fff;cursor:pointer;">&times;</span>
      <video id="video-full" controls autoplay style="max-width:90%;max-height:90%;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.6);"></video>
      <button id="prev-video" style="position:absolute;left:20px;top:50%;transform:translateY(-50%);font-size:40px;color:#fff;background:none;border:none;cursor:pointer;">&#10094;</button>
      <button id="next-video" style="position:absolute;right:20px;top:50%;transform:translateY(-50%);font-size:40px;color:#fff;background:none;border:none;cursor:pointer;">&#10095;</button>
    </div>

    <!-- üî• Section Kontak -->
    <section class="card" style="margin-top:14px">
      <h2 style="margin:0 0 16px 0; text-align:center;">üìûüìßüì±Kontak Sekolah</h2>
      <div class="profile-grid">

        <div class="field">
          <div class="k">Telepon</div>
          <div class="v">081233961727</div>
        </div>

        <div class="field">
          <div class="k">Email</div>
          <div class="v"><a href="mailto:tkdwpklopox@gmail.com">tkdwpklopox@gmail.com</a></div>
        </div>

        <div class="field">
          <div class="k">Website</div>
          <div class="v"><a href="https://tkdwpklopox.netlify.app/" target="_blank">https://tkdwpklopox.netlify.app/</a></div>
        </div>

        <div class="field">
          <div class="k">Instagram</div>
          <div class="v"><a href="https://www.instagram.com/tkdwpklopox/" target="_blank">@tkdwpklopox</a></div>
        </div>

        <div class="field">
          <div class="k">Alamat Lengkap TK DWP Kloposepuluh Pasegan</div>
          <div class="v">Pasegan (Sebelah SDN Kloposepuluh 1), Kloposepuluh, Kec. Sukodono, Kab. Sidoarjo, Prov. Jawa Timur</div>
        </div>

        <div class="field">
          <div class="k">Alamat Lengkap TK DWP Kloposepuluh Wonokoyo</div>
          <div class="v">Kloposepuluh RT 23 RW 06 (Sebelah SDN Kloposepuluh 2), Kec. Sukodono, Kab. Sidoarjo, Prov. Jawa Timur</div>
        </div>

        <div class="field">
          <div class="k">Jam Operasional</div>
          <div class="v">Senin - Sabtu: 07:00 - 13:00 WIB (Kecuali Tanggal Merah atau Cuti Bersama)</div>
        </div>

      </div>
    </section>

    <section class="card" style="margin-top:14px">
      <div class="map-container" style="margin:20px 0; text-align:center;">
        <h2>üìçLokasi Sekolah Pasegan</h2>
        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d247.28926787964912!2d112.68678510320208!3d-7.395481311682645!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2dd7e3f14b213ea1%3A0x449bd3a46273fda!2sTK%20Dharma%20Wanita%20Persatuan%20Klopo%20Sepuluh%20Pasegan!5e0!3m2!1sid!2sid!4v1756187581448!5m2!1sid!2sid" 
            width="250" 
            height="250" 
            style="border:0;" 
            allowfullscreen="" 
            loading="lazy" 
            referrerpolicy="no-referrer-when-downgrade">
        </iframe>
        <h2>üìçLokasi Sekolah Wonokoyo</h2>
        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3956.593248236775!2d112.69582954783125!3d-7.399389320171529!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2dd7e39b3a14f9b5%3A0x7272805c771ac88f!2sTK%20Dharma%20Wanita%20Persatuan%20Kloposepuluh%20Wonokoyo!5e0!3m2!1sid!2sid!4v1756343384044!5m2!1sid!2sid" 
            width="250" 
            height="250" 
            style="border:0;" 
            allowfullscreen="" 
            loading="lazy" 
            referrerpolicy="no-referrer-when-downgrade">
        </iframe>
      </div>
    </section>
    
    <section class="card" style="margin-top:14px">
      <h2 style="text-align:center;margin-bottom:16px;">üí¨ Testimoni Orang Tua</h2>

      <!-- Form -->
      <div class="testi-card">
      <button id="googleLoginBtn" class="btn btn-primary">Login dengan Google</button>
      <div id="userInfo" style="margin-top:20px;"></div><br>
        <form id="testiForm">
          <textarea id="pesan" placeholder="Tulis pesan Anda..." required></textarea>
          <select id="rating">
            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Sangat Puas</option>
            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Puas</option>
            <option value="3">‚≠ê‚≠ê‚≠ê Cukup</option>
            <option value="2">‚≠ê‚≠ê Kurang</option>
            <option value="1">‚≠ê Tidak Puas</option>
          </select>
          <!-- Kritik & Saran -->
          <textarea id="kritik" placeholder="Kritik Anda (opsional, tapi jika diisi maka wajib isi saran)"></textarea>
          <textarea id="saran" placeholder="Saran Anda (opsional)"></textarea>
          <button type="submit">Kirim Testimoni</button>
        </form>
      </div>

      <!-- Overall Rating -->
      <div id="overallRating" class="overall-rating">
        <span class="title">üìë Overall Rating TK DWP Kloposepuluh</span>
        <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
        <span class="score">0.0/5</span>
      </div>
    
      <!-- List Testimoni -->
      <div id="testimoniList"></div>
    </section>
    
  </main>
  <!-- üî• Modal Report -->
  <div id="report-modal" style="display:none;position:fixed;inset:0;background:rgba(3,6,18,0.45);align-items:center;justify-content:center;padding:20px;z-index:9999">
    <div style="max-width:400px;width:100%;background:white;border-radius:12px;padding:18px;box-shadow:0 14px 40px rgba(2,6,23,0.35);">
      <h3 style="margin-top:0">üìë Pilih Jenis Report</h3>

      <label style="display:block;margin-bottom:6px;">Jenis Pengunjung:</label>
      <select id="report-type" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;margin-bottom:12px" onchange="togglePasswordField()">
        <option value="">-- Pilih --</option>
        <option value="calonsiswa">Calon Siswa</option>
        <option value="guru">Guru</option>
      </select>

      <!-- Password untuk guru -->
      <div id="password-wrapper" style="display:none;">
        <label style="display:block;margin-bottom:6px;">Password Guru:</label>
        <input type="password" id="report-pass" placeholder="Password..." style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;margin-bottom:6px">
        <p id="attempt-info" style="color:orange;font-size:13px;display:none;margin:4px 0 0;"></p>
        <p id="report-error" style="color:red;font-size:14px;display:none;margin-top:8px">‚ùå Akses ditolak</p>
      </div>

      <!-- Dropdown jenis data (muncul hanya jika guru + password benar) -->
      <div id="data-type-wrapper" style="display:none;">
        <label style="display:block;margin-bottom:6px;">Jenis Data:</label>
        <select id="data-type" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;margin-bottom:12px">
          <option value="">-- Pilih Data --</option>
          <option value="report">Data Report</option>
          <option value="excel">Data Excel</option>
          <option value="dokumen">Data Dokument</option>
        </select>
      </div>

      <div style="display:flex;gap:10px;margin-top:16px;justify-content:flex-end">
        <button class="btn btn-ghost" onclick="closeReportPopup()">Batal</button>
        <button class="btn btn-primary" onclick="checkReportAccess()">Masuk</button>
      </div>
    </div>
  </div>


  <footer>¬©MOCHAMAD FUAD ASYHARY
  </footer>

  <!-- üî• Captcha -->
  <script>
    //DEBUGGER TRAP
    
    // Allow contextmenu hanya di input/textarea
    document.addEventListener("contextmenu", e => {
      const tag = e.target.tagName.toLowerCase();
      if (tag === "input" || tag === "textarea") {
        return; // biarkan default ‚Üí user bisa copas
      }
      e.preventDefault(); // selain itu tetap di-block
    });
    
    document.addEventListener("contextmenu", e => e.preventDefault());  
    document.addEventListener("keydown", e => {
      if (e.key === "F12" || 
          (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) || 
          (e.ctrlKey && e.key === "U")) {
        e.preventDefault();
      }
    });
    setInterval(() => {
      if (window.outerHeight - window.innerHeight > 100 ||
          window.outerWidth - window.innerWidth > 100) {
        document.body.innerHTML = "<h1 style='color:red;text-align:center;'>‚ùå DevTools terdeteksi! Akses ditolak.</h1>";
      }
    }, 1000);
    setInterval(() => {
      function block() { debugger; }
      block();
    }, 3000);

    //CAPTCHA
    document.addEventListener("DOMContentLoaded", function(){
      const captchaOverlay = document.getElementById("captchaOverlay");
      const captchaArea = document.getElementById("captchaArea");
      const iconContainer = document.getElementById("iconContainer");
      const dropZone = document.getElementById("dropZone");
      const captchaStatus = document.getElementById("captchaStatus");
      const captchaReset = document.getElementById("captchaReset");
    
      const icons = ["‚≠ê", "üå∏", "üê§", "üß∏", "üçé", "üöó"];
      let targetIcon = "";
      let failCount = 0;
    
      function generateCaptcha(){
        iconContainer.innerHTML = "";
        targetIcon = icons[Math.floor(Math.random()*icons.length)];
        captchaStatus.textContent = `üëâ Geser "${targetIcon}" ke kotak üéØ`;
        captchaReset.style.display = "none";
        failCount = 0;
    
        // buat pilihan icon (target wajib ada)
        let choices = [targetIcon];
        while (choices.length < 5) {
          const randIcon = icons[Math.floor(Math.random()*icons.length)];
          if (!choices.includes(randIcon)) choices.push(randIcon);
        }
        choices = choices.sort(() => Math.random() - 0.5);
    
        choices.forEach(symbol => {
          const icon = document.createElement("div");
          icon.textContent = symbol;
          icon.className = "captcha-icon";
          icon.draggable = true;
    
          // Desktop drag
          icon.addEventListener("dragstart", e => {
            e.dataTransfer.setData("text/plain", icon.textContent);
          });
    
          // Mobile touch
          icon.addEventListener("touchstart", e => {
            icon.style.position = "absolute";
            icon.style.zIndex = "1000";
          });
          icon.addEventListener("touchmove", e => {
            let touch = e.touches[0];
            const rect = captchaArea.getBoundingClientRect();
            icon.style.left = (touch.clientX - rect.left - 20) + "px";
            icon.style.top = (touch.clientY - rect.top - 20) + "px";
          });
          icon.addEventListener("touchend", e => {
            checkDrop(icon.textContent, e.changedTouches[0]);
            resetIconPos(icon);
          });
    
          iconContainer.appendChild(icon);
        });
      }
    
      // desktop drop
      dropZone.addEventListener("dragover", e => e.preventDefault());
      dropZone.addEventListener("drop", e => {
        e.preventDefault();
        const dropped = e.dataTransfer.getData("text/plain");
        checkDrop(dropped);
      });
    
      // cek hasil drop
      function checkDrop(value, touch=null){
        if(value === targetIcon){
          captchaStatus.textContent = "‚úÖ Berhasil!";
          setTimeout(()=> captchaOverlay.style.display="none",800);
        } else {
          failCount++;
          if(failCount >= 3){
            captchaStatus.textContent = "‚è≥ Terlalu banyak gagal! Refresh CAPTCHA...";
            setTimeout(()=> generateCaptcha(), 1500);
          } else {
            captchaStatus.textContent = `‚ùå Salah! Percobaan ke-${failCount}`;
            captchaReset.style.display = "block";
          }
        }
      }
    
      function resetIconPos(icon){
        icon.style.position = "";
        icon.style.left = "";
        icon.style.top = "";
        icon.style.zIndex = "";
      }
    
      captchaReset.addEventListener("click", generateCaptcha);
      generateCaptcha();
    
      // üîí Anti-oprek DevTools (cek overlay hilang)
      setInterval(()=>{
        if(!document.body.contains(captchaOverlay) || captchaOverlay.style.display==="none" && failCount<0){
          // jika overlay dihapus manual ‚Üí reload
          location.reload();
        }
      }, 2000);
    });
  </script>
    

  <!-- üî• Report Pendaftaran -->
  <script> 
    let attemptCount = 0;
    let isLocked = false;
    let lockTimeout;
    let countdownInterval;
  
    function openReportPopup(){
      document.getElementById('report-modal').style.display='flex';
      document.getElementById('report-type').value="";
      document.getElementById('password-wrapper').style.display="none";
      document.getElementById('data-type-wrapper').style.display="none";
      document.getElementById('report-error').style.display="none";
      document.getElementById('report-pass').value="";
      document.getElementById('attempt-info').style.display="none";
      document.getElementById('report-pass').disabled=false;
      document.querySelector('#report-modal button.btn-primary').disabled=false;
      attemptCount = 0;
      clearTimeout(lockTimeout);
      clearInterval(countdownInterval);
      isLocked = false;
    }
  
    function closeReportPopup(){
      document.getElementById('report-modal').style.display='none';
    }
  
    function togglePasswordField(){
      const type = document.getElementById('report-type').value;
      document.getElementById('password-wrapper').style.display = (type==="guru") ? "block" : "none";
      document.getElementById('data-type-wrapper').style.display="none";
      document.getElementById('report-error').style.display="none";
      document.getElementById('attempt-info').style.display="none";
    }
  
    function checkReportAccess(){
      const type = document.getElementById('report-type').value;
      const pass = document.getElementById('report-pass').value.trim();
      const dataType = document.getElementById('data-type').value;
  
      if(isLocked){
        return; // kalau masih di-lock jangan bisa login
      }
  
      if(type === "calonsiswa"){
        window.open("https://forms.zohopublic.com/tkdwpklopox/report/CalonSiswa/reportperma/LZvNu6V6osLIWSQjGFR4kFWP9zeIZHd428RnVUukp78","_blank");
        closeReportPopup();
  
      } else if(type === "guru"){
        if(pass === "Tkdwpklopo10"){ // üîë password guru
          attemptCount = 0; // reset counter kalau benar
          document.getElementById('attempt-info').style.display="none";
          if(dataType === ""){
            document.getElementById('data-type-wrapper').style.display="block";
            document.getElementById('report-error').style.display="none";
          } else if(dataType === "report"){
            window.open("https://forms.zohopublic.com/tkdwpklopox/report/Guru/reportperma/upFhj3x_RzPpOSibaucobubAJfpzVZ8Ei3ebuO8Jtgw","_blank");
          } else if(dataType === "excel"){
            window.open("https://docs.google.com/spreadsheets/d/12pnmW0KKCm4V21MunudXJ0yb17-r4BiNeJYW3dXJ5s4/edit?usp=sharing","_blank");
          } else if(dataType === "dokumen"){
            window.open("https://drive.google.com/drive/folders/1NlqQcu4Xwe6HkO7Mg4IpsMrtVYjhEoTO?usp=sharing","_blank");
          }
        } else {
          attemptCount++;
          document.getElementById('report-error').style.display="block";
          document.getElementById('attempt-info').style.display="block";
          document.getElementById('attempt-info').innerText = `‚ùå Password salah (${attemptCount}/5)`;
  
          if(attemptCount >= 5){
            isLocked = true;
            let remaining = 30; // ‚è≥ diganti 30 detik
            document.getElementById('attempt-info').innerText = `‚è≥ Terlalu banyak percobaan gagal. Coba lagi dalam ${remaining} detik.`;
            document.getElementById('report-pass').disabled=true;
            document.querySelector('#report-modal button.btn-primary').disabled=true;
  
            countdownInterval = setInterval(()=>{
              remaining--;
              document.getElementById('attempt-info').innerText = `‚è≥ Terlalu banyak percobaan gagal. Coba lagi dalam ${remaining} detik.`;
              if(remaining <= 0){
                clearInterval(countdownInterval);
                attemptCount = 0;
                isLocked = false;
                document.getElementById('attempt-info').style.display="none";
                document.getElementById('report-pass').disabled=false;
                document.querySelector('#report-modal button.btn-primary').disabled=false;
                document.getElementById('report-pass').focus(); // auto fokus lagi biar enak
              }
            },1000);
          }
        }
      } else {
        document.getElementById('report-error').style.display="block";
      }
    }

    // confetti sprinkle (very small & playful)
    (function(){
      var c=document.createElement('canvas');c.className='confetti';c.width=200;c.height=120;c.style.right='20px';c.style.top='20px';c.style.position='fixed';
      document.body.appendChild(c);
      var ctx=c.getContext('2d');
      var dots=[];for(var i=0;i<12;i++){dots.push({x:Math.random()*200,y:Math.random()*120,r:2+Math.random()*4,c:['#FF7AA2','#FFD166','#7AD6FF','#B3FF9E'][i%4]})}
      dots.forEach(function(d){ctx.fillStyle=d.c;ctx.beginPath();ctx.arc(d.x,d.y,d.r,0,Math.PI*2);ctx.fill()});
    })();

    // Full gallery
    const galleryImages = document.querySelectorAll('.gallery-grid img');
    const modal = document.getElementById('gallery-modal');
    const modalImg = document.getElementById('gallery-full-img');
    const closeBtn = document.getElementById('close-gallery');
    const prevBtn = document.getElementById('prev-img');
    const nextBtn = document.getElementById('next-img');

    let currentIndex = 0;

    galleryImages.forEach((img, idx) => {
      img.addEventListener('click', () => {
        currentIndex = idx;
        modal.style.display = 'flex';
        modalImg.src = img.src;
      });
    });

    closeBtn.addEventListener('click', () => modal.style.display = 'none');

    prevBtn.addEventListener('click', () => {
      currentIndex = (currentIndex - 1 + galleryImages.length) % galleryImages.length;
      modalImg.src = galleryImages[currentIndex].src;
    });

    nextBtn.addEventListener('click', () => {
      currentIndex = (currentIndex + 1) % galleryImages.length;
      modalImg.src = galleryImages[currentIndex].src;
    });

    // optional: keyboard navigation
    document.addEventListener('keydown', (e) => {
      if(modal.style.display === 'flex'){
        if(e.key === 'ArrowLeft') prevBtn.click();
        if(e.key === 'ArrowRight') nextBtn.click();
        if(e.key === 'Escape') closeBtn.click();
      }
    });
    
    function showGallery(id) {
      // sembunyikan semua
      document.querySelectorAll('.gallery-content').forEach(el => el.style.display = 'none');
      document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
      // tampilkan yang dipilih
      document.getElementById(id).style.display = 'grid';
      event.target.classList.add('active');
    }

    function showVideoGallery(id) {
      // Sembunyikan semua konten video
      document.querySelectorAll('#video-galeri-container .video-content')
        .forEach(el => el.style.display = 'none');

      // Reset semua tombol video tab
      document.querySelectorAll('.video-tab-btn')
        .forEach(el => el.classList.remove('active'));

      // Tampilkan konten sesuai ID
      document.getElementById(id).style.display = 'grid';

      // Kasih highlight ke tombol yang diklik
      event.target.classList.add('active');
    }

    // Fullscreen Video Modal
    const videoEls = document.querySelectorAll('#video-galeri-container video');
    const videoModal = document.getElementById('video-modal');
    const videoFull = document.getElementById('video-full');
    const closeVideoBtn = document.getElementById('close-video');
    const prevVideoBtn = document.getElementById('prev-video');
    const nextVideoBtn = document.getElementById('next-video');

    let currentVideoIndex = 0;

    videoEls.forEach((vid, idx) => {
      vid.addEventListener('click', () => {
        currentVideoIndex = idx;
        videoModal.style.display = 'flex';
        videoFull.src = vid.querySelector('source').src;
        videoFull.play();
      });
    });

    closeVideoBtn.addEventListener('click', () => {
      videoModal.style.display = 'none';
      videoFull.pause();
      videoFull.src = ""; // reset supaya tidak bunyi di background
    });

    prevVideoBtn.addEventListener('click', () => {
      currentVideoIndex = (currentVideoIndex - 1 + videoEls.length) % videoEls.length;
      videoFull.src = videoEls[currentVideoIndex].querySelector('source').src;
      videoFull.play();
    });

    nextVideoBtn.addEventListener('click', () => {
      currentVideoIndex = (currentVideoIndex + 1) % videoEls.length;
      videoFull.src = videoEls[currentVideoIndex].querySelector('source').src;
      videoFull.play();
    });

    // optional: keyboard support
    document.addEventListener('keydown', (e) => {
      if(videoModal.style.display === 'flex'){
        if(e.key === 'ArrowLeft') prevVideoBtn.click();
        if(e.key === 'ArrowRight') nextVideoBtn.click();
        if(e.key === 'Escape') closeVideoBtn.click();
      }
    });
  </script>
  
  <!-- üî• Integration Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onChildAdded, onValue, set, update, child, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { 
      getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect, 
      getRedirectResult, signOut, onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  
    // ‚úÖ Config
    const firebaseConfig = {
      apiKey: "AIzaSyA8bzx6ispP9u2e3fzKGqqEY2Zmle_CEHY",
      authDomain: "testimoni-tk-dwp-kloposepuluh.firebaseapp.com",
      databaseURL: "https://testimoni-tk-dwp-kloposepuluh-default-rtdb.firebaseio.com",
      projectId: "testimoni-tk-dwp-kloposepuluh",
      storageBucket: "testimoni-tk-dwp-kloposepuluh.firebasestorage.app",
      messagingSenderId: "148758047246",
      appId: "1:148758047246:web:6f408f3d622393bb356a5f",
      measurementId: "G-34N9E2FXVX"
    };
  
    // ‚úÖ Inisialisasi
    const app = initializeApp(firebaseConfig);
    const gdb = getDatabase(app);
    const testimoniRef = ref(gdb, "testimoni");
    const galleryRef = ref(gdb, "galeri");
    const guruRef = ref(gdb, "guru");
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();
    const testiListEl = document.getElementById("testimoniList");
    
    const categoryButtons = document.getElementById("categoryButtons");
    const galleryContainer = document.getElementById("galleryContainer");
    const guruContainer = document.getElementById("guruContainer");
  
    // Tombol Login
    document.getElementById("googleLoginBtn").addEventListener("click", () => {
      signInWithPopup(auth, provider)
        .catch((error) => {
          if (error.code === "auth/popup-blocked") {
            signInWithRedirect(auth, provider);
          } else {
            alert("Login gagal: " + error.message);
          }
        });
    });
  
    // ‚úÖ Ambil hasil dari redirect login
    getRedirectResult(auth).then(async (result) => {
      if (result && result.user) {
        const user = result.user;
        await setDoc(doc(db, "users", user.uid), {
          name: user.displayName,
          email: user.email,
          photo: user.photoURL,
          lastLogin: new Date()
        });
      }
    }).catch((error) => {
      console.error("Redirect error:", error);
    });
  
    // ‚úÖ Auto cek status login/logout
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        document.getElementById("userInfo").innerHTML = `
          <p>Halo, <b>${user.displayName}</b> üëã</p>
          <img src="${user.photoURL}" alt="Foto Profil" width="80" style="border-radius:50%">
          <button id="logoutBtn" style="background:red;color:white;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;">Logout</button>
        `;

        document.getElementById("logoutBtn").addEventListener("click", () => {
          signOut(auth).then(() => {
            document.getElementById("userInfo").innerHTML = "";
            alert("Logout berhasil ‚úÖ");
          });
        });

        // üî• Prefill testimoni user sendiri kalau ada
        const userRef = ref(gdb, "testimoni/" + user.uid);
        const snapshot = await get(userRef);
        if (snapshot.exists()) {
          const data = snapshot.val();
          document.getElementById("pesan").value = data.pesan || "";
          document.getElementById("rating").value = data.rating || "5";
          document.getElementById("kritik").value = data.kritik || "";
          document.getElementById("saran").value = data.saran || "";
        } else {
          // Kalau belum ada ‚Üí biarkan form kosong
          document.getElementById("pesan").value = "";
          document.getElementById("rating").value = "5";
          document.getElementById("kritik").value = "";
          document.getElementById("saran").value = "";
        }

      } else {
        document.getElementById("userInfo").innerHTML = "";
        // üî• Form tetap kosong kalau belum login
        document.getElementById("pesan").value = "";
        document.getElementById("rating").value = "5";
        document.getElementById("kritik").value = "";
        document.getElementById("saran").value = "";
      }
    });
  
    // ‚úÖ Event form
    const form = document.getElementById("testiForm");
    const list = document.getElementById("testimoniList");
    
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const pesan = document.getElementById("pesan").value;
      const rating = Number(document.getElementById("rating").value);
      const kritik = document.getElementById("kritik").value;
      const saran = document.getElementById("saran").value;

      const now = new Date();
      const options = { day:"2-digit", month:"2-digit", year:"numeric", 
                        hour:"2-digit", minute:"2-digit", second:"2-digit" };
      const tanggalJam = now.toLocaleDateString("id-ID", options);

      const user = auth.currentUser;
      if (!user) {
        alert("Login dulu sebelum kirim testimoni!");
        return;
      }

      // ‚úÖ Validasi rating
      if (rating < 4) {
        if (!kritik || !saran) {
          alert("Kalau rating di bawah 4, Kritik & Saran wajib diisi!");
          return;
        }
      } 

      // ‚úÖ Simpan dengan key = UID (biar unik per user)
      const userRef = ref(gdb, "testimoni/" + user.uid);

      await set(userRef, {
        foto: user.photoURL,
        nama: user.displayName,
        email: user.email,
        pesan,
        rating,
        kritik,
        saran,
        tanggalJam
      });

      alert("Testimoni berhasil disimpan ‚úÖ");
    });

    onValue(testimoniRef, (snapshot) => {
      console.log("üì° Data snapshot:", snapshot.val()); // debug log

      testiListEl.innerHTML = ""; // clear dulu
      if (snapshot.exists()) {
        snapshot.forEach((child) => {
          const data = child.val();
          console.log("üî• Data child:", data); // debug tiap child
          testiListEl.innerHTML += `
        <div style="display:flex; align-items:flex-start; margin-bottom:15px;">
          <img src="${data.foto}" alt="Foto Profil" width="80" 
              style="border-radius:50%; margin-right:12px;">
  
          <div>
            <p style="margin:0; font-weight:bold; font-size:16px;">${data.nama}</p>
            <p style="margin:2px 0; color:orange;">${"‚≠ê".repeat(Number(data.rating))}</p>
            <small style="color:gray;">${data.tanggalJam}</small>
          </div>
        </div>
  
        <p style="margin-top:5px;">${data.pesan}</p>
        ${data.kritik ? `<p style="color:red; margin:0;"><strong>Kritik:</strong> ${data.kritik}</p>` : ""}
        ${data.saran ? `<p style="color:green; margin:0;"><strong>Saran:</strong> ${data.saran}</p>` : ""}
      `;
        });
      } else {
        testiListEl.innerHTML = "<p>Belum ada testimoni</p>";
      }
    });
  
    // Fungsi update rating keseluruhan
    function updateOverallRating(ratings) {
      if (ratings.length === 0) {
        document.getElementById("overallRating").innerHTML =
          `<span class="stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span> <span class="score">0.0/5</span>`;
        return;
      }
      
      let avg = ratings.reduce((a, b) => a + b, 0) / ratings.length;
      let stars = "‚≠ê".repeat(Math.round(avg)) + "‚òÜ".repeat(5 - Math.round(avg));
      
      document.getElementById("overallRating").innerHTML =
        `<span class="title">üìë Overall Rating TK DWP Kloposepuluh</span>
        <span class="stars">${stars}</span> <span class="score">${avg.toFixed(1)}/5</span>`;
    }
  
    // üî• Ambil data testimoni & hitung rata-rata rating
    onValue(testimoniRef, (snapshot) => {
      let ratings = [];
      snapshot.forEach((child) => {
        let data = child.val();
        if (data.rating) ratings.push(Number(data.rating));
      });
      updateOverallRating(ratings);
    });
    
    let allData = [];

    onValue(galleryRef, (snapshot) => {
      galleryContainer.innerHTML = "";
      categoryButtons.innerHTML = "";
      allData = [];

      const categories = new Set();

      snapshot.forEach((child) => {
        const data = child.val();
        allData.push(data);
        categories.add(data.kategori);
      });

      // ‚úÖ Buat tombol kategori
      const allBtn = document.createElement("button");
      allBtn.textContent = "Semua";
      allBtn.className = "tab-btn";
      allBtn.onclick = (e) => {
        document.querySelectorAll("#categoryButtons .tab-btn")
          .forEach(el => el.classList.remove("active"));
        e.target.classList.add("active");
        renderGallery(allData);
      };
      categoryButtons.appendChild(allBtn);

      categories.forEach((cat) => {
        const btn = document.createElement("button");
        btn.textContent = cat;
        btn.className = "tab-btn";
        btn.onclick = (e) => {
          // reset semua tombol
          document.querySelectorAll("#categoryButtons .tab-btn")
            .forEach(el => el.classList.remove("active"));

          // kasih active ke tombol yang diklik
          e.target.classList.add("active");

          // render ulang galeri sesuai kategori
          const filtered = allData.filter((d) => d.kategori === cat);
          renderGallery(filtered);
        };
        categoryButtons.appendChild(btn);
      });

      // Tampilkan semua default
      renderGallery(allData);
    });

    function renderGallery(data) {
      galleryContainer.innerHTML = "";
      data.forEach((item) => {
        let media = "";
        if (item.jenis === "foto") {
          media = `<img src="${item.url}" alt="${item.judul}" class="gallery-img">`;
        } else if (item.jenis === "video") {
          media = `<video controls class="gallery-video">
                    <source src="${item.url}" type="video/mp4">
                  </video>`;
        }
        galleryContainer.innerHTML += `
          <div class="gallery-item">
            <b>${item.judul}</b>
            ${media}
          </div>`;
      });
    }

    galleryContainer.addEventListener("click", (e) => {
      if (e.target.classList.contains("gallery-img")) {
        modal.style.display = "flex";
        modalImg.src = e.target.src;
        modalImg.style.maxWidth = "90%";
        modalImg.style.maxHeight = "90%";
      }
    });

    onValue(guruRef, (snapshot) => {
      guruContainer.innerHTML = "";
      if (snapshot.exists()) {
        snapshot.forEach((child) => {
          const data = child.val();
          guruContainer.innerHTML += `
            <div class="guru-card">
              <img src="${data.foto}" alt="${data.nama}" class="guru-img">
              <h3>${data.nama}</h3>
              <p>${data.jabatan}</p>
              <p>${data.keterangan}</p>
            </div>
          `;
        });
      } else {
        guruContainer.innerHTML = "<p>Belum ada data guru</p>";
      }
    });
  </script>  
</body>
</html>
