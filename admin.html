<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin Galeri</title>
  <link rel="icon" type="image/png" href="logo admin galeri.png"><style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f8fafc;
      color: #333;
    }
  
    h1, h2 {
      color: #222;
    }
  
    .card {
      background: #fff;
      padding: 16px;
      border-radius: 16px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }
  
    input, select {
      width: 95%;
      max-width: 200px;
      padding: 10px;
      margin: 6px 0;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 14px;
    }
  
    button {
      padding: 10px 14px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin: 6px 4px;
      font-size: 14px;
      transition: 0.2s ease-in-out;
    }
  
    .btn-primary {
      background: #007bff;
      color: white;
    }
    .btn-primary:hover {
      background: #0056b3;
    }
  
    .btn-danger {
      background: #dc3545;
      color: white;
    }
    .btn-danger:hover {
      background: #b02a37;
    }
  
    .btn-warning {
      background: #ffc107;
      color: black;
    }
    .btn-warning:hover {
      background: #e0a800;
    }
  
    /* ‚úÖ Table modern style */
    .table-container {
      width: 100%;
      overflow-x: auto;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      background: #fff;
      margin-top: 12px;
    }

    table {
      width: 50%;
      border-collapse: collapse;
      font-size: 14px;
      min-width: 50px;
    }

    th, td {
      padding: 12px 16px;
      border-bottom: 1px solid #eee;
      vertical-align: middle;
    }

    th {
      background: #f1f5f9;
      font-weight: bold;
      color: #444;
    }

    tr:hover {
      background: #f9fafb;
    }

    td img, td video {
      max-width: 200px;
      border-radius: 8px;
      margin-top: 6px;
    }

    .action-buttons button {
      margin: 2px;
    }
  
    .gallery-item {
      border: 1px solid #eee;
      padding: 12px;
      border-radius: 12px;
      margin-bottom: 12px;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
  
    /* ‚úÖ Responsive tweak */
    @media (max-width: 768px) {
      body { padding: 12px; }
      input, select { max-width: 100%; }
      table { font-size: 13px; }
      th, td { padding: 10px; }
    }
  </style>
</head>
<body>
  <h2>üì∏ Manajemen Galeri</h2>

  <!-- üîí Login sederhana -->
  <div id="loginCard" class="card">
    <h2>üîë Login Admin</h2>
    <input type="password" id="adminPass" placeholder="Masukkan password" required>
    <button onclick="login()" class="btn-primary">Login</button>
    <p id="loginError" style="color:red;display:none;">‚ùå Password salah!</p>
  </div>
  
  <!-- Form Galeri (disembunyikan dulu) -->
  <div id="adminPanel" style="display:none;">
    <div class="card">
      <form id="galleryForm">
          <input type="hidden" id="galleryId">

          <label>Jenis</label>
          <br>
          <select id="jenis" required>
              <option value="foto">Foto</option>
              <option value="video">Video</option>
          </select>
          <br>
          <label>Kategori</label>
          <br>
          <select id="kategori" required>
            <option value="MPLS">MPLS</option>
            <option value="Sekolah">Sekolah</option>
            <option value="Senam">Senam</option>
            <option value="Makan Bersama">Makan Bersama</option>
            <option value="Belajar Nilai Agama">Belajar Nilai Agama</option>
            <option value="Takjil">Bagi Takjil</option>
            <option value="Manasik Haji">Manasik Haji</option>
            <option value="Pelepasan Siswa">Pelepasan Siswa</option>
            <option value="lainnya">‚ûï Lainnya...</option>
          </select>
          <br>
          <!-- Input tambahan untuk kategori custom -->
          <input type="text" id="kategoriCustom" placeholder="Isi kategori baru" style="display:none; margin-top:8px;">

          <label>Judul</label>
          <br>
          <input type="text" id="judul" placeholder="Judul media" required>
          <br>
          <label>URL Gambar/Video</label>
          <br>
          <input type="url" id="url" placeholder="https://example.com/media.jpg" required>
          <br>
          <!-- üî• Preview otomatis -->
          <div id="preview" style="margin-top:10px;"></div>
          <br>
          <button type="submit" class="btn-primary">üíæ Simpan</button>
          <button type="button" onclick="resetForm()" class="btn-warning">üîÑ Reset</button>
      </form>
    </div>

    <!-- ‚úÖ Filter input -->
    <input type="text" id="gallerySearch" placeholder="Cari judul atau kategori..."
      style="padding:8px;width:100%;max-width:300px;margin-bottom:12px;border-radius:8px;border:1px solid #ccc;">
    <div class="table-container">
      <table id="galleryTable" border="1" style="width:100%;border-collapse:collapse;">
        <thead>
          <tr>
            <th>Preview Data</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="galleryList">
          <!-- data galeri dari Firebase -->
        </tbody>
      </table>
    </div>

    <h2>üë®‚Äçüè´ Manajemen Guru</h2>

    <div class="card">
      <form id="guruForm">
          <input type="hidden" id="guruId">

          <label>Nama Guru</label><br>
          <input type="text" id="guruNama" placeholder="Nama lengkap" required><br>

          <label>Jabatan</label><br>
          <input type="text" id="guruJabatan" placeholder="Contoh: Kepala Sekolah" required><br>

          <label>Foto (URL)</label><br>
          <input type="url" id="guruFoto" placeholder="https://example.com/foto.jpg" required><br>

          <label>Keterangan</label><br>
          <input type="text" id="guruKeterangan" placeholder="Misalnya: Guru senior bidang Matematika"><br>

          <div id="guruPreview" style="margin-top:10px;"></div><br>

          <button type="submit" class="btn-primary">üíæ Simpan</button>
          <button type="button" onclick="resetGuruForm()" class="btn-warning">üîÑ Reset</button>
      </form>
    </div>

    <div class="table-container">
      <table id="guruTable" border="1" style="width:100%;border-collapse:collapse;">
        <thead>
          <tr>
            <th>Profil Guru</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="guruList"></tbody>
      </table>
    </div>
</div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  
    // ‚úÖ Config Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA8bzx6ispP9u2e3fzKGqqEY2Zmle_CEHY",
      authDomain: "testimoni-tk-dwp-kloposepuluh.firebaseapp.com",
      databaseURL: "https://testimoni-tk-dwp-kloposepuluh-default-rtdb.firebaseio.com",
      projectId: "testimoni-tk-dwp-kloposepuluh",
      storageBucket: "testimoni-tk-dwp-kloposepuluh.firebasestorage.app",
      messagingSenderId: "148758047246",
      appId: "1:148758047246:web:35211d0a9a4cac11356a5f",
      measurementId: "G-54N43JC5WC"
    };
  
    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const galleryRef = ref(db, "galeri");
    const guruRef = ref(db, "guru");

    const guruForm = document.getElementById("guruForm");
    const guruList = document.getElementById("guruList");
    const guruIdField = document.getElementById("guruId");
  
    const form = document.getElementById("galleryForm");
    const list = document.getElementById("galleryList");
    const idField = document.getElementById("galleryId");
  
    const kategoriInput = document.getElementById("kategori");
    const kategoriCustom = document.getElementById("kategoriCustom");
  
    // üëÄ Tampilkan input custom kalau pilih "lainnya"
    kategoriInput.addEventListener("change", () => {
      if (kategoriInput.value === "lainnya") {
        kategoriCustom.style.display = "block";
        kategoriCustom.required = true;
      } else {
        kategoriCustom.style.display = "none";
        kategoriCustom.required = false;
      }
    });
  
    // üöÄ Simpan / Update
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = idField.value || Date.now();
  
      // ‚úÖ Ambil kategori sesuai pilihan
      let kategoriValue =
        kategoriInput.value === "lainnya"
          ? kategoriCustom.value.trim()
          : kategoriInput.value;
  
      // Tambahin ke dropdown kalau kategori custom & belum ada
      if (
        kategoriInput.value === "lainnya" &&
        kategoriValue &&
        ![...kategoriInput.options].some((opt) => opt.value === kategoriValue)
      ) {
        const newOption = document.createElement("option");
        newOption.value = kategoriValue;
        newOption.textContent = kategoriValue;
        kategoriInput.insertBefore(newOption, kategoriInput.lastElementChild); // taruh sebelum "Lainnya"
        kategoriInput.value = kategoriValue;
        kategoriCustom.value = "";
        kategoriCustom.style.display = "none";
      }
  
      const data = {
        jenis: document.getElementById("jenis").value,
        kategori: kategoriValue,
        judul: document.getElementById("judul").value,
        url: document.getElementById("url").value,
        updatedAt: new Date().toISOString(),
      };
  
      await set(ref(db, "galeri/" + id), data);
      alert("‚úÖ Data tersimpan!");
      resetForm();
    });
  
    // üìÇ Tampilkan Data
    onValue(galleryRef, (snapshot) => {
      list.innerHTML = "";
      snapshot.forEach((child) => {
        const id = child.key;
        const data = child.val();

        let mediaPreview = "";
        if (data.jenis === "foto") {
          mediaPreview = `<img src="${data.url}" alt="foto">`;
        } else if (data.jenis === "video") {
          mediaPreview = `
            <video controls>
              <source src="${data.url}" type="video/mp4">
            </video>`;
        }

        list.innerHTML += `
          <tr>
            <td>
              <b>[${data.jenis}]</b> ${data.kategori} - ${data.judul}<br>
              ${mediaPreview}
            </td>
            <td class="action-buttons">
              <button onclick="editGallery('${id}','${data.jenis}','${data.kategori}','${data.judul}','${data.url}')" class="btn-warning">‚úèÔ∏è Edit</button>
              <br><button onclick="deleteGallery('${id}')" class="btn-danger">üóëÔ∏è Hapus</button>
            </td>
          </tr>`;
      });
    });
  
    // ‚úèÔ∏è Edit
    window.editGallery = (id, jenis, kategori, judul, url) => {
      idField.value = id;
      document.getElementById("jenis").value = jenis;
      document.getElementById("judul").value = judul;
      document.getElementById("url").value = url;
  
      // kalau kategori sudah ada di dropdown ‚Üí pilih langsung
      if ([...kategoriInput.options].some((opt) => opt.value === kategori)) {
        kategoriInput.value = kategori;
        kategoriCustom.style.display = "none";
      } else {
        // kalau custom, set ke "lainnya" dan isi textbox
        kategoriInput.value = "lainnya";
        kategoriCustom.style.display = "block";
        kategoriCustom.value = kategori;
      }
    };
  
    // üóëÔ∏è Hapus
    window.deleteGallery = async (id) => {
      if (confirm("Yakin hapus data?")) {
        await set(ref(db, "galeri/" + id), null);
        alert("üóëÔ∏è Data terhapus!");
      }
    };
  
    // üîÑ Reset
    window.resetForm = () => {
      idField.value = "";
      form.reset();
      kategoriCustom.style.display = "none";
    };
  
    // üî• Preview otomatis
    const urlInput = document.getElementById("url");
    const jenisInput = document.getElementById("jenis");
    const preview = document.getElementById("preview");
  
    function updatePreview() {
      const url = urlInput.value.trim();
      const jenis = jenisInput.value;
      preview.innerHTML = "";
  
      if (!url) return;
  
      if (jenis === "foto") {
        preview.innerHTML = `<img src="${url}" alt="preview" style="max-width:200px; border-radius:8px; margin-top:8px;">`;
      } else if (jenis === "video") {
        preview.innerHTML = `
          <video controls style="max-width:250px; border-radius:8px; margin-top:8px;">
            <source src="${url}" type="video/mp4">
            Browser tidak mendukung video.
          </video>`;
      }
    }
      
    urlInput.addEventListener("input", updatePreview);
    jenisInput.addEventListener("change", updatePreview);

    guruForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = guruIdField.value || Date.now();

      const data = {
        nama: document.getElementById("guruNama").value,
        jabatan: document.getElementById("guruJabatan").value,
        foto: document.getElementById("guruFoto").value,
        keterangan: document.getElementById("guruKeterangan").value,
        updatedAt: new Date().toISOString(),
      };

      await set(ref(db, "guru/" + id), data);
      alert("‚úÖ Profil guru tersimpan!");
      resetGuruForm();
    });

    // üìÇ Tampilkan Data Guru
    onValue(guruRef, (snapshot) => {
      guruList.innerHTML = "";
      snapshot.forEach((child) => {
        const id = child.key;
        const data = child.val();

        guruList.innerHTML += `
          <tr>
            <td>
              <b>${data.nama}</b> - ${data.jabatan}<br>
              <img src="${data.foto}" alt="foto guru" style="max-width:120px;border-radius:12px;"><br>
              <small>${data.keterangan || ""}</small>
            </td>
            <td>
              <button onclick="editGuru('${id}','${data.nama}','${data.jabatan}','${data.foto}','${data.keterangan || ""}')" class="btn-warning">‚úèÔ∏è Edit</button>
              <button onclick="deleteGuru('${id}')" class="btn-danger">üóëÔ∏è Hapus</button>
            </td>
          </tr>`;
      });
    });

    // ‚úèÔ∏è Edit Guru
    window.editGuru = (id, nama, jabatan, foto, keterangan) => {
      guruIdField.value = id;
      document.getElementById("guruNama").value = nama;
      document.getElementById("guruJabatan").value = jabatan;
      document.getElementById("guruFoto").value = foto;
      document.getElementById("guruKeterangan").value = keterangan;
    };

    // üóëÔ∏è Hapus Guru
    window.deleteGuru = async (id) => {
      if (confirm("Yakin hapus profil guru?")) {
        await set(ref(db, "guru/" + id), null);
        alert("üóëÔ∏è Profil terhapus!");
      }
    };

    // üîÑ Reset Form
    window.resetGuruForm = () => {
      guruIdField.value = "";
      guruForm.reset();
    };

    // üî• Preview otomatis foto
    const guruFotoInput = document.getElementById("guruFoto");
    const guruPreview = document.getElementById("guruPreview");
    guruFotoInput.addEventListener("input", () => {
      const url = guruFotoInput.value.trim();
      guruPreview.innerHTML = url ? `<img src="${url}" style="max-width:150px;border-radius:12px;">` : "";
    });

    // ‚úÖ Filter pencarian
    document.getElementById("gallerySearch").addEventListener("input", function() {
      const filter = this.value.toLowerCase();
      const items = document.querySelectorAll("#galleryList .gallery-item");

      items.forEach(item => {
        const text = item.textContent.toLowerCase();
        if (text.includes(filter)) {
          item.style.display = "";
        } else {
          item.style.display = "none";
        }
      });
    });
  </script>
  
  <script>
    // Ganti password sesuai kebutuhan
    const ADMIN_PASSWORD = "Tkdwpklopo10";

    function login() {
      const pass = document.getElementById("adminPass").value;
      if (pass === ADMIN_PASSWORD) {
        document.getElementById("loginCard").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        localStorage.setItem("isLoggedIn", "true"); // simpan status login
      } else {
        document.getElementById("loginError").style.display = "block";
      }
    }

    function logout() {
      localStorage.removeItem("isLoggedIn");
      document.getElementById("loginCard").style.display = "block";
      document.getElementById("adminPanel").style.display = "none";
    }

    // Biar tetap login setelah refresh
    window.onload = () => {
      if (localStorage.getItem("isLoggedIn") === "true") {
        document.getElementById("loginCard").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
      }
    };
  </script>
  
</body>
</html>
